<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' http://localhost:*; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob:; connect-src 'self' ws://localhost:* http://localhost:* https://fonts.googleapis.com https://fonts.gstatic.com; object-src 'none'; base-uri 'self'; frame-ancestors 'none';"
    />
    <title>p2p share</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <!-- Background effects -->
    <div class="bg-noise"></div>
    <div class="bg-glow bg-glow--primary"></div>
    <div class="bg-glow bg-glow--secondary"></div>

    <div class="app">
      <!-- Header -->
      <header class="header">
        <div class="brand">
          <svg class="brand-icon" width="28" height="28" viewBox="0 0 28 28" fill="none">
            <circle cx="8" cy="14" r="3" fill="#FF8F74" opacity="0.9" />
            <circle cx="20" cy="14" r="3" fill="#FF8F74" opacity="0.9" />
            <line
              x1="11"
              y1="14"
              x2="17"
              y2="14"
              stroke="#FF8F74"
              stroke-width="1.5"
              stroke-dasharray="2 2"
              opacity="0.5"
            />
            <circle cx="14" cy="14" r="12" stroke="#FF8F74" stroke-width="1" opacity="0.15" />
          </svg>
          <span class="brand-name">p2p share</span>
        </div>
        <span id="platformInfo" class="header-meta">Loading...</span>
      </header>

      <!-- Main content -->
      <div class="main">
        <!-- ===== CONFIG VIEW ===== -->
        <div id="viewConfig" class="view">
          <!-- Mode tabs -->
          <div class="mode-selector">
            <button id="tabSend" class="mode-tab mode-tab--active" data-mode="send" type="button">
              <svg
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M9 14V4M9 4L5 8M9 4l4 4" />
              </svg>
              Send
            </button>
            <button id="tabReceive" class="mode-tab" data-mode="receive" type="button">
              <svg
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M9 4v10M9 14l-4-4M9 14l4-4" />
              </svg>
              Receive
            </button>
          </div>

          <!-- Send configuration -->
          <div id="sendConfig" class="config-section">
            <div class="variant-bar">
              <button
                class="variant-btn variant-btn--active"
                data-variant="send_wait"
                type="button"
              >
                Create ticket
              </button>
              <button class="variant-btn" data-variant="send_to_ticket" type="button">
                To ticket
              </button>
            </div>

            <button id="dropZone" class="drop-zone" type="button">
              <svg
                class="drop-zone-icon"
                width="40"
                height="40"
                viewBox="0 0 40 40"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="8" y="6" width="24" height="28" rx="3" />
                <path d="M14 22l6-6 6 6" />
                <path d="M20 16v12" />
              </svg>
              <span class="drop-zone-label">Drop a file here or click to browse</span>
              <span id="fileName" class="drop-zone-file hidden"></span>
            </button>

            <div id="sendTicketField" class="field hidden">
              <label class="field-label">Destination ticket</label>
              <input
                id="sendTicketInput"
                class="input"
                type="text"
                placeholder="p2psh:..."
                spellcheck="false"
                autocomplete="off"
              />
            </div>
          </div>

          <!-- Receive configuration -->
          <div id="receiveConfig" class="config-section hidden">
            <div class="variant-bar">
              <button
                class="variant-btn variant-btn--active"
                data-variant="receive_target"
                type="button"
              >
                From ticket
              </button>
              <button class="variant-btn" data-variant="receive_listen" type="button">
                Listen for sender
              </button>
            </div>

            <div id="targetField" class="field">
              <label class="field-label">Ticket or address</label>
              <input
                id="targetInput"
                class="input"
                type="text"
                placeholder="p2psh:... or ip:port"
                spellcheck="false"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label class="field-label">Save to</label>
              <div class="input-row">
                <input
                  id="outputDir"
                  class="input"
                  type="text"
                  placeholder="Choose output directory"
                  spellcheck="false"
                />
                <button id="pickOutputBtn" class="btn-browse" type="button">Browse</button>
              </div>
            </div>
          </div>

          <!-- Start action -->
          <button id="startBtn" class="btn-primary" type="button">Start Transfer</button>
        </div>

        <!-- ===== TRANSFER VIEW ===== -->
        <div id="viewTransfer" class="view hidden">
          <!-- Status bar -->
          <div class="transfer-top">
            <div class="status-badge">
              <span id="statusDot" class="status-dot"></span>
              <span id="statusText">Connecting...</span>
            </div>
            <button id="cancelBtn" class="btn-ghost" type="button">Cancel</button>
          </div>

          <!-- P2P connection visualization -->
          <div id="p2pViz" class="p2p-viz">
            <div class="node">
              <span class="node-dot"></span>
              <span class="node-label">You</span>
            </div>
            <div id="p2pLink" class="p2p-link">
              <div class="p2p-pulse"></div>
            </div>
            <div class="node">
              <span class="node-dot"></span>
              <span class="node-label">Peer</span>
            </div>
          </div>

          <!-- Info cards -->
          <div class="cards-row">
            <div class="card">
              <span class="card-label">Connection</span>
              <span id="connectionText" class="card-value">Waiting...</span>
            </div>
            <div class="card">
              <span class="card-label">Verification</span>
              <span id="handshakeCode" class="card-value card-value--mono">- - - -</span>
            </div>
          </div>

          <!-- Progress -->
          <div class="progress-block">
            <div class="progress-header">
              <span id="progressPercent" class="progress-pct">0%</span>
              <span id="progressDetail" class="progress-detail"></span>
            </div>
            <div class="progress-track">
              <div id="progressFill" class="progress-fill"></div>
            </div>
          </div>

          <!-- Ticket + QR sharing area -->
          <div id="shareArea" class="share-area hidden">
            <button id="qrTrigger" class="qr-frame" type="button" title="Click to enlarge">
              <img id="qrImage" alt="QR Code" />
            </button>
            <div class="ticket-block">
              <span class="card-label">Share this ticket with the other device</span>
              <code id="ticketValue" class="ticket-code">Generating...</code>
              <button id="copyBtn" class="btn-copy" type="button">
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 16 16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="5" y="5" width="8" height="8" rx="1.5" />
                  <path d="M11 3H4.5A1.5 1.5 0 003 4.5V11" />
                </svg>
                <span>Copy</span>
              </button>
            </div>
          </div>

          <!-- QR fullscreen overlay -->
          <div id="qrOverlay" class="qr-overlay hidden">
            <div class="qr-overlay-content">
              <img id="qrOverlayImage" alt="QR Code" />
              <span class="qr-overlay-hint">Click anywhere to close</span>
            </div>
          </div>

          <!-- Completion banner -->
          <div id="completeSummary" class="result-banner result-banner--success hidden">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 10l3 3 5-6" />
              <circle cx="10" cy="10" r="8" />
            </svg>
            <div class="result-info">
              <span class="result-title">Transfer Complete</span>
              <span id="completeDetail" class="result-detail"></span>
            </div>
          </div>

          <!-- Error banner -->
          <div id="errorSummary" class="result-banner result-banner--error hidden">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="10" cy="10" r="8" />
              <path d="M7 7l6 6M13 7l-6 6" />
            </svg>
            <div class="result-info">
              <span class="result-title">Transfer Failed</span>
              <span id="errorDetail" class="result-detail"></span>
            </div>
          </div>

          <!-- New transfer button (shown after completion/error) -->
          <button id="newTransferBtn" class="btn-primary hidden" type="button">New Transfer</button>
        </div>
      </div>

      <!-- Event Log -->
      <div class="log-section">
        <button id="logToggle" class="log-toggle" type="button">
          <span>Event Log</span>
          <svg
            id="logChevron"
            class="log-chevron"
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M4 6l4 4 4-4" />
          </svg>
        </button>
        <div id="logPanel" class="log-panel hidden">
          <div class="log-bar">
            <button id="clearLogBtn" class="btn-ghost-sm" type="button">Clear</button>
          </div>
          <pre id="eventLog" class="log-pre"></pre>
        </div>
      </div>
    </div>

    <script type="module" src="./renderer.ts"></script>
  </body>
</html>
